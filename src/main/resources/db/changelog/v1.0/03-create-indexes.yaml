databaseChangeLog:
  - changeSet:
      id: 03-create-event-store-indexes
      author: trademaster-dev-team
      changes:
        - createIndex:
            indexName: idx_event_correlation_id
            tableName: event_store
            columns:
              - column:
                  name: correlation_id
        - createIndex:
            indexName: idx_event_priority
            tableName: event_store
            columns:
              - column:
                  name: priority
        - createIndex:
            indexName: idx_event_timestamp
            tableName: event_store
            columns:
              - column:
                  name: created_at
        - createIndex:
            indexName: idx_event_source
            tableName: event_store
            columns:
              - column:
                  name: source_service
        - createIndex:
            indexName: idx_event_type
            tableName: event_store
            columns:
              - column:
                  name: event_type
        - createIndex:
            indexName: idx_event_status
            tableName: event_store
            columns:
              - column:
                  name: processing_status
        - createIndex:
            indexName: idx_event_priority_status
            tableName: event_store
            columns:
              - column:
                  name: priority
              - column:
                  name: processing_status
              - column:
                  name: created_at
      rollback:
        - dropIndex:
            indexName: idx_event_correlation_id
            tableName: event_store
        - dropIndex:
            indexName: idx_event_priority
            tableName: event_store
        - dropIndex:
            indexName: idx_event_timestamp
            tableName: event_store
        - dropIndex:
            indexName: idx_event_source
            tableName: event_store
        - dropIndex:
            indexName: idx_event_type
            tableName: event_store
        - dropIndex:
            indexName: idx_event_status
            tableName: event_store
        - dropIndex:
            indexName: idx_event_priority_status
            tableName: event_store

  - changeSet:
      id: 04-create-websocket-indexes
      author: trademaster-dev-team
      changes:
        - createIndex:
            indexName: idx_ws_user_id
            tableName: websocket_connections
            columns:
              - column:
                  name: user_id
        - createIndex:
            indexName: idx_ws_session_id
            tableName: websocket_connections
            columns:
              - column:
                  name: session_id
        - createIndex:
            indexName: idx_ws_status
            tableName: websocket_connections
            columns:
              - column:
                  name: connection_status
        - createIndex:
            indexName: idx_ws_created_at
            tableName: websocket_connections
            columns:
              - column:
                  name: created_at
        - createIndex:
            indexName: idx_ws_last_activity
            tableName: websocket_connections
            columns:
              - column:
                  name: last_activity_at
      rollback:
        - dropIndex:
            indexName: idx_ws_user_id
            tableName: websocket_connections
        - dropIndex:
            indexName: idx_ws_session_id
            tableName: websocket_connections
        - dropIndex:
            indexName: idx_ws_status
            tableName: websocket_connections
        - dropIndex:
            indexName: idx_ws_created_at
            tableName: websocket_connections
        - dropIndex:
            indexName: idx_ws_last_activity
            tableName: websocket_connections